# 导航投屏功能使用指南

## 功能概述

导航投屏功能允许您将导航信息通过蓝牙发送到电动车屏幕上，实现：
- 目的地选择
- 路线规划
- 实时导航信息投屏
- 转弯提示显示
- 距离和时间显示

## 使用步骤

### 1. 连接蓝牙

在开始导航前，请确保：
- 已通过蓝牙连接车辆（见蓝牙连接页面）
- 蓝牙连接状态正常

### 2. 选择目的地

1. 打开导航页面
2. 点击"目的地"选择框
3. 在地图上选择目的地
4. 确认选择

### 3. 开始导航

1. 点击"开始导航"按钮
2. 系统会自动：
   - 规划路线
   - 将导航信息发送到车辆屏幕
   - 打开手机地图导航
   - 开始实时更新导航信息

### 4. 导航过程中

- 导航信息每5秒自动更新到车辆屏幕
- 显示剩余距离和剩余时间
- 显示下一个转弯提示
- 可以随时停止导航

## 投屏数据格式

### 开始导航数据

```json
{
  "cmd": "NAV_START",
  "data": {
    "destination": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "name": "目的地名称",
      "address": "详细地址"
    },
    "route": [...],
    "totalDistance": 5000,
    "estimatedTime": 300
  },
  "timestamp": 1234567890
}
```

### 更新导航数据

```json
{
  "cmd": "NAV_UPDATE",
  "data": {
    "currentStep": 0,
    "nextTurn": {
      "instruction": "左转",
      "distance": 200
    },
    "remainingDistance": 4500,
    "remainingTime": 270,
    "currentLocation": {
      "latitude": 39.9000,
      "longitude": 116.4000
    },
    "direction": "left",
    "distance": 200
  },
  "timestamp": 1234567890
}
```

### 停止导航数据

```json
{
  "cmd": "NAV_STOP",
  "timestamp": 1234567890
}
```

## 方向说明

- `straight` - 直行
- `left` - 左转
- `right` - 右转
- `uturn` - 掉头

## 技术说明

### 路线规划

当前使用简化的路线规划（模拟数据）。实际使用时应该：
1. 集成地图API（如腾讯地图、高德地图）
2. 获取真实路线数据
3. 解析转弯点信息

### 实时更新

- 更新频率：每5秒
- 更新内容：
  - 当前位置
  - 剩余距离
  - 剩余时间
  - 下一个转弯信息

### 位置获取

导航过程中需要实时获取当前位置：
- 可以使用 `wx.getLocation` API
- 或使用车辆GPS位置（如果车辆提供）

## 集成地图API示例

### 使用腾讯地图

```javascript
// 需要引入腾讯地图SDK
import QQMapWX from '../../libs/qqmap-wx-jssdk';

const qqmapsdk = new QQMapWX({
  key: 'YOUR_KEY'
});

// 路线规划
qqmapsdk.direction({
  mode: 'driving',
  from: `${startLat},${startLon}`,
  to: `${endLat},${endLon}`,
  success: (res) => {
    // 处理路线数据
  }
});
```

### 使用高德地图

```javascript
// 需要引入高德地图SDK
// 类似的方式调用路线规划API
```

## 车辆屏幕显示建议

车辆屏幕应该显示：
1. **当前导航状态**：导航中/已到达
2. **下一个转弯**：方向图标 + 距离
3. **剩余信息**：距离 + 时间
4. **路线概览**：简化路线图（可选）

## 注意事项

1. **蓝牙连接**：必须保持蓝牙连接才能投屏
2. **位置权限**：需要位置权限才能使用导航
3. **路线规划**：当前为模拟数据，需要集成真实地图API
4. **更新频率**：可根据实际情况调整更新频率
5. **电池消耗**：频繁更新可能增加电池消耗

## 故障排查

### 问题1：投屏失败
- 检查蓝牙连接状态
- 检查车辆是否支持导航投屏
- 查看控制台错误信息

### 问题2：导航信息不更新
- 检查位置权限
- 检查定时器是否正常运行
- 检查蓝牙连接是否断开

### 问题3：路线规划失败
- 检查网络连接
- 检查地图API配置
- 检查起点和终点是否有效
