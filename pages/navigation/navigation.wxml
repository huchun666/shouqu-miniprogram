<!--pages/navigation/navigation.wxml-->
<view class="container">
  <view class="nav-header">
    <text class="title">å¯¼èˆª</text>
  </view>

  <!-- åœ°å›¾ -->
  <view class="map-section card" wx:if="{{location}}">
    <map
      id="navMap"
      longitude="{{location.longitude}}"
      latitude="{{location.latitude}}"
      scale="18"
      markers="{{markers}}"
      show-location
      class="map">
    </map>
  </view>

  <!-- ç›®çš„åœ°é€‰æ‹© -->
  <view class="destination-section card">
    <view class="destination-item" bindtap="chooseDestination">
      <text class="destination-label">ç›®çš„åœ°</text>
      <text class="destination-value">{{destination ? destination.name : 'è¯·é€‰æ‹©ç›®çš„åœ°'}}</text>
      <text class="destination-arrow">></text>
    </view>
    <view class="destination-address" wx:if="{{destination && destination.address}}">
      <text>{{destination.address}}</text>
    </view>
  </view>

  <!-- è·¯çº¿ä¿¡æ¯ -->
  <view class="route-info card" wx:if="{{route && destination}}">
    <view class="route-item">
      <text class="route-label">æ€»è·ç¦»</text>
      <text class="route-value">{{route.distance >= 1000 ? (route.distance/1000) + 'km' : route.distance + 'm'}}</text>
    </view>
    <view class="route-item">
      <text class="route-label">é¢„è®¡æ—¶é—´</text>
      <text class="route-value">{{route.estimatedTime >= 60 ? Math.floor(route.estimatedTime/60) + 'åˆ†é’Ÿ' : route.estimatedTime + 'ç§’'}}</text>
    </view>
  </view>

  <!-- å¯¼èˆªçŠ¶æ€ -->
  <view class="nav-status card" wx:if="{{navigating}}">
    <view class="status-header">
      <text class="status-title">å¯¼èˆªä¸­</text>
      <text class="bluetooth-status-text" wx:if="{{bluetoothConnected}}">å·²æŠ•å±</text>
    </view>
    <view class="status-info">
      <view class="status-item">
        <text class="status-label">å‰©ä½™è·ç¦»</text>
        <text class="status-value">{{remainingDistance >= 1000 ? (remainingDistance/1000) + 'km' : remainingDistance + 'm'}}</text>
      </view>
      <view class="status-item">
        <text class="status-label">å‰©ä½™æ—¶é—´</text>
        <text class="status-value">{{remainingTime >= 60 ? Math.floor(remainingTime/60) + 'åˆ†é’Ÿ' : remainingTime + 'ç§’'}}</text>
      </view>
    </view>
    <button class="stop-nav-btn" bindtap="stopNavigation">åœæ­¢å¯¼èˆª</button>
  </view>

  <!-- å¯¼èˆªæŒ‰é’® -->
  <view class="nav-actions">
    <button 
      class="nav-btn" 
      bindtap="startNavigation" 
      disabled="{{!destination || navigating}}">
      {{navigating ? 'å¯¼èˆªä¸­...' : 'å¼€å§‹å¯¼èˆª'}}
    </button>
    <view class="bluetooth-tip" wx:if="{{bluetoothConnected && !navigating}}">
      <text>ğŸ’¡ å¯¼èˆªä¿¡æ¯å°†è‡ªåŠ¨æŠ•å±åˆ°è½¦è¾†å±å¹•</text>
    </view>
  </view>
</view>
